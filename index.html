<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Melomuse ¬∑ Acc√®s ateliers</title>
<style>
  :root { --bg:#0f1115; --card:#171923; --text:#e6e6e6; --muted:#9aa3b2; --accent:#7dd3fc; --ok:#34d399; --err:#fca5a5; }
  *{box-sizing:border-box} body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",sans-serif;background:radial-gradient(1200px 1200px at 80% -200px,#1f2937 10%,#0f1115 70%);color:var(--text);min-height:100svh;display:grid;place-items:center;padding:24px}
  .card{width:100%;max-width:720px;background:linear-gradient(180deg,#1b1f2a 0,#12141b 100%);border:1px solid #2a2f3d;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35);overflow:hidden}
  header{padding:22px 22px 0;display:flex;gap:12px;align-items:center}
  .logo{width:44px;height:44px;border-radius:12px;background:conic-gradient(from 0deg,#60a5fa,#a78bfa,#34d399,#60a5fa);filter:saturate(120%)}
  h1{margin:0;font-size:20px;letter-spacing:.2px}
  .sub{margin:2px 0 0;color:var(--muted);font-size:14px}
  main{padding:22px}
  .gate{display:grid;gap:12px;margin:6px 0 18px}
  label{font-size:14px;color:var(--muted)}
  input[type=password]{width:100%;padding:12px 14px;border:1px solid #2a2f3d;border-radius:12px;background:#0f1115;color:var(--text);outline:none}
  input[type=password]:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(125,211,252,.15)}
  button{padding:12px 16px;border:1px solid #2a2f3d;background:#171923;color:var(--text);border-radius:12px;cursor:pointer}
  button:focus{outline:2px solid var(--accent);outline-offset:2px}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .err{color:var(--err);font-size:13px;min-height:1.2em}
  .ok{color:var(--ok);font-size:13px;min-height:1.2em}
  .links{display:none;margin-top:8px}
  .grid{display:grid;gap:12px}
  @media (min-width:640px){.grid{grid-template-columns:1fr 1fr}}
  .tile{border:1px solid #2a2f3d;border-radius:14px;padding:14px;background:linear-gradient(180deg,#161925,#12141b);display:flex;flex-direction:column;gap:6px}
  .tile h3{margin:0;font-size:16px}
  .tile p{margin:0;color:var(--muted);font-size:13px}
  .tile a{margin-top:auto;display:inline-block;padding:10px 12px;border-radius:10px;border:1px solid #2a2f3d;text-decoration:none;color:var(--text)}
  footer{padding:0 22px 22px;color:var(--muted);font-size:12px}
</style>
</head>
<body>
  <div class="card" role="region" aria-labelledby="title">
    <header>
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1 id="title">Acc√®s ateliers Melomuse</h1>
        <p class="sub">Espace d√©mo (pr√©sentiel & distanciel)</p>
      </div>
    </header>
    <main>
      <form id="gateForm" class="gate" novalidate>
        <div>
          <label for="pass">Mot de passe atelier</label>
          <input id="pass" name="pass" type="password" autocomplete="current-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" aria-describedby="status" required />
        </div>
        <div class="row">
          <button type="submit">Entrer</button>
          <button type="button" id="show" aria-pressed="false" aria-controls="pass">Afficher</button>
        </div>
        <div id="status" class="err" role="status" aria-live="polite"></div>
        <div id="okmsg" class="ok" role="status" aria-live="polite"></div>
      </form>

      <section id="links" class="links" aria-label="Jeux disponibles">
        <div class="grid">
          <article class="tile">
            <h3>üéµ L‚ÄôOreille Magique</h3>
            <p>√âcoute active & m√©moire auditive</p>
            <a href="#" target="_blank" rel="noopener">Ouvrir</a>
          </article>
          <article class="tile">
            <h3>üü¶ Simon</h3>
            <p>S√©quences sons & couleurs (non punitif)</p>
            <a href="https://carwars.github.io/melomuse-simon/" target="_blank" rel="noopener">Ouvrir</a>
          </article>
          <article class="tile">
            <h3>‚õ∞Ô∏è L‚ÄôEscalier des hauteurs</h3>
            <p>Associer la note jou√©e √† la bonne marche</p>
            <a href="#" target="_blank" rel="noopener">Ouvrir</a>
          </article>
          <article class="tile">
            <h3>üÉè Jeu des cartes</h3>
            <p>Cartes corporelles & visuelles (musicoth√©rapie)</p>
            <a href="#" target="_blank" rel="noopener">Ouvrir</a>
          </article>
        </div>
      </section>
    </main>
    <footer>
      Astuce ateliers : change le mot de passe apr√®s l‚Äô√©v√®nement et r√©g√©n√®re le QR code.
    </footer>
  </div>

<script>
/** CONFIG ‚Äî mot de passe actuel = "melomuse2025" */
const PASSWORD_HASH = "17f84ead6b4df1adade21da5d4e5fe0f682b2f6265aa462e720b2ddcd43c47d5";

// (optionnel) Restreindre par session (ex: ajouter ?session=2025-09-06 au QR)
const REQUIRED_SESSION = null; // ex: "2025-09-06"

const $pass = document.getElementById('pass');
const $status = document.getElementById('status');
const $okmsg = document.getElementById('okmsg');
const $links = document.getElementById('links');
const $form = document.getElementById('gateForm');
const $show = document.getElementById('show');

$show.addEventListener('click', () => {
  const on = $pass.type === 'password';
  $pass.type = on ? 'text' : 'password';
  $show.setAttribute('aria-pressed', String(on));
  $show.textContent = on ? 'Masquer' : 'Afficher';
  $pass.focus();
});

$form.addEventListener('submit', async (e) => {
  e.preventDefault();
  $status.textContent = "";
  $okmsg.textContent = "";
  const pwd = $pass.value.trim();
  if (!pwd) { $status.textContent = "Entre le mot de passe."; return; }

  if (REQUIRED_SESSION) {
    const url = new URL(location.href);
    if (url.searchParams.get("session") !== REQUIRED_SESSION) {
      $status.textContent = "Lien de session invalide ou expir√©.";
      return;
    }
  }

  const enc = new TextEncoder().encode(pwd);
  const hbuf = await crypto.subtle.digest("SHA-256", enc);
  const hash = Array.from(new Uint8Array(hbuf)).map(b=>b.toString(16).padStart(2,"0")).join("");

  if (hash === PASSWORD_HASH) {
    $links.style.display = 'block';
    $okmsg.textContent = "Acc√®s autoris√©. Bonne d√©mo !";
    $form.style.display = 'none';
    sessionStorage.setItem('melomuse_ok', '1');
  } else {
    $status.textContent = "Mot de passe incorrect.";
    $pass.select();
  }
});

// Auto-d√©verrouillage si d√©j√† valid√© durant la session
if (sessionStorage.getItem('melomuse_ok') === '1') {
  $links.style.display = 'block';
  document.querySelector('main .gate').style.display = 'none';
  $okmsg.textContent = "Acc√®s restaur√© pour la session.";
}

// Accessibilit√© : Enter soumet, Escape efface
$pass.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') { $pass.value=""; $status.textContent=""; }
});
</script>
</body>
</html>
